!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("tools")):"function"==typeof define&&define.amd?define("sound-engine",["tools"],t):"object"==typeof exports?exports["sound-engine"]=t(require("tools")):e["sound-engine"]=t(e.tools)}("undefined"!=typeof self?self:this,function(e){return function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(t,n){t.exports=e},function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(0),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(u),c="playing",f="paused",d="finished",h=function(e){function t(e){var n,s;a(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.audioContext=null,o.offlineAudioContext=null,o.stateBehaviors=(n={},i(n,c,{init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var e=this.getDuration();return this.getCurrentTime()/e||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}}),i(n,f,{init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var e=this.getDuration();return this.getCurrentTime()/e||0},getCurrentTime:function(){return this.startPosition}}),i(n,d,{init:function(){this.removeOnAudioProcess(),this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}}),n),o.params=e,o.ac=e.audioContext||o.getAudioContext(),o.lastPlay=o.ac.currentTime,o.startPosition=0,o.scheduledPause=null,o.states=(s={},i(s,c,Object.create(o.stateBehaviors[c])),i(s,f,Object.create(o.stateBehaviors[f])),i(s,d,Object.create(o.stateBehaviors[d])),s),o.analyser=null,o.buffer=null,o.filters=[],o.gainNode=null,o.mergedPeaks=null,o.offlineAc=null,o.playbackRate=1,o.analyser=null,o.scriptNode=null,o.source=null,o.splitPeaks=[],o.state=null,o}return s(t,e),o(t,[{key:"supportsWebAudio",value:function(){return!(!window.AudioContext&&!window.webkitAudioContext)}},{key:"getAudioContext",value:function(){return window.SoundEngineAudioContext||(window.SoundEngineAudioContext=new(window.AudioContext||window.webkitAudioContext)),window.SoundEngineAudioContext}},{key:"getOfflineAudioContext",value:function(e){return window.SoundEngineOfflineAudioContext||(window.SoundEngineOfflineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,e)),window.SoundEngineOfflineAudioContext}}]),o(t,[{key:"init",value:function(){this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setState(f),this.setPlaybackRate(this.params.audioRate),this.setLength(0)}},{key:"disconnectFilters",value:function(){this.filters&&(this.filters.forEach(function(e){e&&e.disconnect()}),this.filters=null,this.analyser.connect(this.gainNode))}},{key:"setState",value:function(e){this.state!==this.states[e]&&(this.state=this.states[e],this.state.init.call(this))}},{key:"setFilter",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.setFilters(t)}},{key:"setFilters",value:function(e){this.disconnectFilters(),e&&e.length&&(this.filters=e,this.analyser.disconnect(),e.reduce(function(e,t){return e.connect(t),t},this.analyser).connect(this.gainNode))}},{key:"createScriptNode",value:function(){this.ac.createScriptProcessor?this.scriptNode=this.ac.createScriptProcessor(t.scriptBufferSize):this.scriptNode=this.ac.createJavaScriptNode(t.scriptBufferSize),this.scriptNode.connect(this.ac.destination)}},{key:"addOnAudioProcess",value:function(){var e=this;this.scriptNode.onaudioprocess=function(){var t=e.getCurrentTime(),n=e.getDuration();t>=n?(e.setState(d),e.fireEvent("pause")):t>=e.scheduledPause?e.pause():e.state===e.states[c]&&e.fireEvent("audioprocess",t,n)}}},{key:"removeOnAudioProcess",value:function(){this.scriptNode.onaudioprocess=null}},{key:"createAnalyserNode",value:function(){this.analyser=this.ac.createAnalyser(),this.analyser.connect(this.gainNode)}},{key:"createVolumeNode",value:function(){this.ac.createGain?this.gainNode=this.ac.createGain():this.gainNode=this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)}},{key:"setVolume",value:function(e){this.gainNode.gain.value=e}},{key:"getVolume",value:function(){return this.gainNode.gain.value}},{key:"decodeArrayBuffer",value:function(e,t,n){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac?this.ac.sampleRate:44100)),this.offlineAc.decodeAudioData(e,function(e){return t(e)},n)}},{key:"setLength",value:function(e){if(!this.mergedPeaks||e!==2*this.mergedPeaks.length-1+2){var t=this.getPeaksData(this.buffer,e);this.splitPeaks=t.splitPeaks,this.mergedPeaks=t.mergedPeaks}}},{key:"getPeaksData",value:function(e,t){var n=[],i=[],a=e?e.numberOfChannels:1,r=void 0;for(r=0;r<a;r++)n[r]=[],n[r][2*(t-1)]=0,n[r][2*(t-1)+1]=0;return i[2*(t-1)]=0,i[2*(t-1)+1]=0,{splitPeaks:n,mergedPeaks:i}}},{key:"getPeaks",value:function(e,t,n){if(this.setLength(e),!this.buffer.length){var i=this.createBuffer(1,4096,this.sampleRate);this.buffer=i.buffer}var a=this.getPeaksFromBuffer(this.buffer,e,t,n);return this.splitPeaks=a.splitPeaks,this.mergedPeaks=a.mergedPeaks,this.params.splitChannels?this.splitPeaks:this.mergedPeaks}},{key:"getPeaksFromBuffer",value:function(e,t,n,i){n=n||0,i=i||t-1;var a=this.getPeaksData(e,t),r=a.splitPeaks,s=a.mergedPeaks,o=e.length/t,u=~~(o/10)||1,l=e.numberOfChannels,c=void 0;for(c=0;c<l;c++){var f=r[c],d=e.getChannelData(c),h=void 0;for(h=n;h<=i;h++){var y=~~(h*o),p=~~(y+o),k=0,v=0,m=void 0;for(m=y;m<p;m+=u){var b=d[m];b>v&&(v=b),b<k&&(k=b)}f[2*h]=v,f[2*h+1]=k,(0===c||v>s[2*h])&&(s[2*h]=v),(0===c||k<s[2*h+1])&&(s[2*h+1]=k)}}return{splitPeaks:r,mergedPeaks:s}}},{key:"getPlayedPercents",value:function(){return this.state.getPlayedPercents.call(this)}},{key:"disconnectSource",value:function(){this.source&&this.source.disconnect()}},{key:"destroy",value:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect(),this.params.closeAudioContext&&("function"==typeof this.ac.close&&"closed"!==this.ac.state&&this.ac.close(),this.ac=null,this.params.audioContext?this.params.audioContext=null:window.SoundEngineAudioContext=null,window.SoundEngineOfflineAudioContext=null)}},{key:"load",value:function(e){l.Val.get()&&(this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=e,this.createSource())}},{key:"createSource",value:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.source.playbackRate.value=this.playbackRate,this.source.buffer=this.buffer,this.source.connect(this.analyser)}},{key:"isPaused",value:function(){return this.state!==this.states[c]}},{key:"getDuration",value:function(){return this.buffer?this.buffer.duration:0}},{key:"seekTo",value:function(e,t){if(this.buffer&&l.Val.get())return this.scheduledPause=null,null==e&&(e=this.getCurrentTime())>=this.getDuration()&&(e=0),null==t&&(t=this.getDuration()),this.startPosition=e,this.lastPlay=this.ac.currentTime,this.state===this.states[d]&&this.setState(f),{start:e,end:t}}},{key:"getPlayedTime",value:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate}},{key:"play",value:function(e,t){if(this.buffer&&l.Val.get()){this.createSource();var n=this.seekTo(e,t);e=n.start,t=n.end,this.scheduledPause=t,this.source.start(0,e,t-e),"suspended"===this.ac.state&&this.ac.resume&&this.ac.resume(),this.setState(c),this.fireEvent("play")}}},{key:"pause",value:function(){this.scheduledPause=null,this.startPosition+=this.getPlayedTime(),this.source&&this.source.stop(0),this.setState(f),this.fireEvent("pause")}},{key:"getCurrentTime",value:function(){return this.state.getCurrentTime.call(this)}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"setPlaybackRate",value:function(e){e=e||1,this.isPaused()?this.playbackRate=e:(this.pause(),this.playbackRate=e,this.play())}}]),t}(l.Observer);h.scriptBufferSize=256,t.default=h,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(3),a=function(e){return e&&e.__esModule?e:{default:e}}(i);t.default=a.default,e.exports=t.default},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(0),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(u),c=n(1),f=i(c),d=n(4),h=i(d),y=function(e){function t(e){var n;a(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.defaultParams={audioContext:null,audioRate:1,backend:"MediaElement",mediaContainer:null,mediaControls:!1,mediaType:"audio",normalize:!1,skipLength:2},i.backends={MediaElement:h.default,WebAudio:f.default},i.params=l.extend({},i.defaultParams,e),i.savedVolume=0,i.isMuted=!1,i.tmpEvents=[],i.currentAjax=null,i.arraybuffer=null,i.backend=null,i.Backend=i.backends[i.params.backend],i.isDestroyed=!1,i.isReady=!1,n=i,r(i,n)}return s(t,e),o(t,null,[{key:"create",value:function(e){return new t(e).init()}}]),o(t,[{key:"init",value:function(){if("MediaElement"===this.params.backend&&("string"==typeof this.params.mediaContainer?this.mediaContainer=document.querySelector(this.params.mediaContainer):this.mediaContainer=this.params.mediaContainer,!this.mediaContainer))throw new Error("Media Container element not found");return this.createBackend(),this}},{key:"createBackend",value:function(){var e=this;this.backend&&this.backend.destroy(),"WebAudio"!==this.params.backend||this.Backend.prototype.supportsWebAudio.call(null)||(this.params.backend="MediaElement"),this.backend=new this.Backend(this.params),this.backend.init(),this.fireEvent("backend-created",this.backend),this.backend.on("finish",function(){return e.fireEvent("finish")}),this.backend.on("play",function(){return e.fireEvent("play")}),this.backend.on("pause",function(){return e.fireEvent("pause")}),this.backend.on("audioprocess",function(t,n){e.fireEvent("audioprocess",t,n)})}},{key:"getDuration",value:function(){return this.backend.getDuration()}},{key:"getCurrentTime",value:function(){return this.backend.getCurrentTime()}},{key:"setCurrentTime",value:function(e){var t=this.getDuration();0===t&&this.seekTo(0),t<=e?this.seekTo(1):this.seekTo(e/t)}},{key:"getCurrentPos",value:function(){var e=this.getDuration();if(0===e)return 0;var t=this.getCurrentTime(),n=t/e;return e<=n?1:n}},{key:"setCurrentPos",value:function(e){var t=this.getDuration();0===t&&this.seekTo(0),t<=e?this.seekTo(1):this.seekTo(e)}},{key:"play",value:function(e,t){this.backend.play(e,t)}},{key:"pause",value:function(){this.backend.isPaused()||this.backend.pause()}},{key:"playPause",value:function(){this.backend.isPaused()?this.play():this.pause()}},{key:"isPlaying",value:function(){return!this.backend.isPaused()}},{key:"skipBackward",value:function(e){this.skip(-e||-this.params.skipLength)}},{key:"skipForward",value:function(e){this.skip(e||this.params.skipLength)}},{key:"skip",value:function(e){var t=this.getDuration()||1,n=this.getCurrentTime()||0;n=Math.max(0,Math.min(t,n+(e||0))),this.seekTo(n/t)}},{key:"seekTo",value:function(e){var t=this.backend.isPaused();t||this.backend.pause(),this.backend.seekTo(e*this.getDuration()),t||this.backend.play(),this.fireEvent("seek",e*this.getDuration())}},{key:"stop",value:function(){this.pause(),this.seekTo(0)}},{key:"setVolume",value:function(e){this.backend.setVolume(e)}},{key:"getVolume",value:function(){return this.backend.getVolume()}},{key:"setPlaybackRate",value:function(e){this.backend.setPlaybackRate(e)}},{key:"getPlaybackRate",value:function(){return this.backend.getPlaybackRate()}},{key:"toggleMute",value:function(){this.setMute(!this.isMuted)}},{key:"setMute",value:function(e){e!==this.isMuted&&(e?(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0):(this.backend.setVolume(this.savedVolume),this.isMuted=!1))}},{key:"getMute",value:function(){return this.isMuted}},{key:"getFilters",value:function(){return this.backend.filters||[]}},{key:"loadArrayBuffer",value:function(e){var t=this;this.decodeArrayBuffer(e,function(e){t.isDestroyed||t.loadDecodedBuffer(e)})}},{key:"loadDecodedBuffer",value:function(e){this.backend.load(e),this.fireEvent("ready"),this.isReady=!0}},{key:"loadBlob",value:function(e){var t=this,n=new FileReader;n.addEventListener("progress",function(e){return t.onProgress(e)}),n.addEventListener("load",function(e){return t.loadArrayBuffer(e.target.result)}),n.addEventListener("error",function(){return t.fireEvent("error","Error reading file")}),n.readAsArrayBuffer(e),this.empty()}},{key:"load",value:function(e,t){switch(this.empty(),this.isMuted=!1,this.params.backend){default:case"WebAudio":return this.loadBuffer(e);case"MediaElement":return this.loadMediaElement(e,t)}}},{key:"loadBuffer",value:function(e){var t=this;return this.getArrayBuffer(e,function(e){return t.loadArrayBuffer(e)})}},{key:"loadMediaElement",value:function(e,t){var n=this,i=e;if("string"==typeof e)this.backend.load(i,this.mediaContainer,t);else{var a=e;this.backend.loadElt(a),i=a.src}this.tmpEvents.push(this.backend.once("canplay",function(){n.fireEvent("ready")}),this.backend.once("error",function(e){return n.fireEvent("error",e)}))}},{key:"decodeArrayBuffer",value:function(e,t){var n=this;this.arraybuffer=e,this.backend.decodeArrayBuffer(e,function(i){n.isDestroyed||n.arraybuffer!==e||(t(i),n.arraybuffer=null)},function(){return n.fireEvent("error","Error decoding audiobuffer")})}},{key:"getArrayBuffer",value:function(e,t){var n=this,i=l.ajax({url:e,responseType:"arraybuffer"});return this.currentAjax=i,this.tmpEvents.push(i.on("progress",function(e){n.onProgress(e)}),i.on("success",function(e,i){t(e),n.currentAjax=null}),i.on("error",function(e){n.fireEvent("error","XHR error: "+e.target.statusText),n.currentAjax=null})),i}},{key:"onProgress",value:function(e){var t=void 0;t=e.lengthComputable?e.loaded/e.total:e.loaded/(e.loaded+1e6),this.fireEvent("loading",Math.round(100*t),e.target)}},{key:"getPeaks",value:function(e,t,n){return this.backend.getPeaks(e,t,n)}},{key:"getPeaksFromBuffer",value:function(e,t,n,i){var a=this.backend.getPeaksFromBuffer(e,t,n,i);return this.params.splitChannels?a.splitPeaks:a.mergedPeaks}},{key:"exportPCM",value:function(e,t,n,i,a){e=e||1024,t=t||0,n=n||e,i=i||1e4;var r=this.backend.getPeaks(e,t,n),s=[].map.call(r,function(e){return Math.round(e*i)/i});return JSON.stringify(s)}},{key:"cancelAjax",value:function(){this.currentAjax&&(this.currentAjax.xhr.abort(),this.currentAjax=null)}},{key:"clearTmpEvents",value:function(){this.tmpEvents.forEach(function(e){return e.un()})}},{key:"empty",value:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.cancelAjax(),this.clearTmpEvents()}},{key:"destroy",value:function(){this.fireEvent("destroy"),this.cancelAjax(),this.clearTmpEvents(),this.unAll(),this.backend.destroy(),this.isDestroyed=!0,this.arraybuffer=null}}]),t}(l.Observer);t.default=y,e.exports=t.default},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function e(t,n,i){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,i)}if("value"in a)return a.value;var s=a.get;if(void 0!==s)return s.call(i)},u=n(0),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(u),c=n(1),f=function(e){return e&&e.__esModule?e:{default:e}}(c),d=function(e){function t(e){i(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.params=e,n.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){}},n.mediaType=e.mediaType.toLowerCase(),n.elementPosition=e.elementPosition,n.playbackRate=1,n.buffer=null,n.onPlayEnd=null,n}return r(t,e),s(t,[{key:"init",value:function(){var e=this;this.setPlaybackRate(this.params.audioRate),setInterval(function(){e.isPaused()||e.fireEvent("audioprocess",e.getCurrentTime(),e.getDuration())},100)}},{key:"createTimer",value:function(){var e=this,t=function t(){if(!e.isPaused()){e.fireEvent("audioprocess",e.getCurrentTime(),e.getDuration());(window.requestAnimationFrame||window.webkitRequestAnimationFrame)(t)}};this.on("play",t)}},{key:"load",value:function(e,t,n){if(l.Val.get()){var i=document.createElement(this.mediaType);i.controls=this.params.mediaControls,i.autoplay=this.params.autoplay||!1,i.preload=n||"metadata",i.src=e,i.style.width="100%";var a=t.querySelector(this.mediaType);a&&t.removeChild(a),t.appendChild(i),this._load(i)}}},{key:"loadElt",value:function(e){e.controls=this.params.mediaControls,e.autoplay=this.params.autoplay||!1,this._load(e)}},{key:"_load",value:function(e){var t=this;"function"==typeof e.load&&e.load(),e.addEventListener("error",function(){t.fireEvent("error","Error loading media element")}),e.addEventListener("canplay",function(){t.fireEvent("canplay")}),e.addEventListener("ended",function(){t.fireEvent("finish")}),e.addEventListener("play",function(){t.fireEvent("play")}),e.addEventListener("pause",function(){t.fireEvent("pause")}),this.media=e,this.onPlayEnd=null,this.buffer=null,this.setPlaybackRate(this.playbackRate)}},{key:"isPaused",value:function(){return!this.media||this.media.paused}},{key:"getDuration",value:function(){var e=(this.buffer||this.media).duration;return isNaN(e)?0:(e>=1/0&&(e=this.media.seekable.end(0)),e)}},{key:"getCurrentTime",value:function(){return this.media&&this.media.currentTime}},{key:"getPlayedPercents",value:function(){return this.getCurrentTime()/this.getDuration()||0}},{key:"getPlaybackRate",value:function(){return this.playbackRate||this.media.playbackRate}},{key:"setPlaybackRate",value:function(e){this.playbackRate=e||1,this.media.playbackRate=this.playbackRate}},{key:"seekTo",value:function(e){null!=e&&(this.media.currentTime=e),this.clearPlayEnd()}},{key:"play",value:function(e,t){l.Val.get()&&(this.seekTo(e),this.media.play(),t&&this.setPlayEnd(t))}},{key:"pause",value:function(){this.media&&this.media.pause(),this.clearPlayEnd()}},{key:"setPlayEnd",value:function(e){var t=this;this._onPlayEnd=function(n){n>=e&&(t.pause(),t.seekTo(e))},this.on("audioprocess",this._onPlayEnd)}},{key:"clearPlayEnd",value:function(){this._onPlayEnd&&(this.un("audioprocess",this._onPlayEnd),this._onPlayEnd=null)}},{key:"getPeaks",value:function(e,n,i){return this.buffer?o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getPeaks",this).call(this,e,n,i):[]}},{key:"getVolume",value:function(){return this.media.volume}},{key:"setVolume",value:function(e){this.media.volume=e}},{key:"destroy",value:function(){this.pause(),this.unAll(),this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}]),t}(f.default);t.default=d,e.exports=t.default}])});